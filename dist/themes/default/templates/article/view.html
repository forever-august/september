{% extends "base.html" %}

{% block title %}{{ article.subject }} - {{ config.site_name }}{% endblock %}

{% block content %}
<article class="article-view">
    <header class="article-header">
        <a href="{{ back_url }}" class="back-link">&larr; {{ back_label }}</a>
        <h1>{{ article.subject }}</h1>
        <div class="article-meta">
            <span class="author">{{ article.from }}</span>
            <span class="separator">Â·</span>
            <span class="date">{{ article.date | timeago }}</span>
        </div>
    </header>

    {% if article.headers %}
    <div class="article-headers-section">
        <button class="toggle-headers" onclick="this.parentElement.classList.toggle('expanded'); this.querySelector('.show-text').hidden = this.parentElement.classList.contains('expanded'); this.querySelector('.hide-text').hidden = !this.parentElement.classList.contains('expanded');">
            <span class="toggle-icon"></span>
            <span class="show-text">Show headers</span>
            <span class="hide-text" hidden>Hide headers</span>
        </button>
        <div class="article-headers">
            <pre class="headers-text">{{ article.headers }}</pre>
        </div>
    </div>
    {% endif %}

    <div class="article-content">
        {% if article.body %}
        <pre class="article-text">{{ article.body }}</pre>
        {% else %}
        <p class="no-content">Article content not available.</p>
        {% endif %}
    </div>

    {% if user and can_post and group %}
    <div class="article-actions">
        <button type="button" class="reply-toggle" onclick="toggleReplyForm(this)">Reply to this article</button>
    </div>
    <div class="reply-form-container" style="display: none;">
        <form action="/a/{{ article.message_id | urlencode_strict }}/reply" method="POST" class="reply-form">
            <input type="hidden" name="group" value="{{ group }}">
            <input type="hidden" name="subject" value="Re: {{ article.subject }}">
            <input type="hidden" name="references" value="{{ article.references | default(value='') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            <textarea name="body" required rows="8" placeholder="Write your reply..."></textarea>
            <div class="reply-form-actions">
                <button type="submit" class="submit-button">Post Reply</button>
                <button type="button" class="cancel-button" onclick="toggleReplyForm(this)">Cancel</button>
            </div>
        </form>
    </div>
    {% endif %}

    <footer class="article-footer">
        <p class="message-id">Message-ID: {{ article.message_id }}</p>
    </footer>
</article>
{% endblock %}
